var ontlogin=function(e){"use strict";var t,r,n,s,o,i;e.Version=void 0,(e.Version||(e.Version={})).Version1="1.0",e.MessageType=void 0,(t=e.MessageType||(e.MessageType={})).ClientHello="ClientHello",t.ServerHello="ServerHello",t.ClientResponse="ClientResponse",e.Action=void 0,(r=e.Action||(e.Action={}))[r.IdAuth=0]="IdAuth",r[r.IdAuthAndVcAuth=1]="IdAuthAndVcAuth",e.ErrorEnum=void 0,(n=e.ErrorEnum||(e.ErrorEnum={})).VersionNotSupport="ERR_WRONG_VERSION",n.TypeNotSupport="ERR_TYPE_NOT_SUPPORTED",n.ActionNotSupport="ERR_ACTION_NOT_SUPPORTED",n.UnknownError="ERR_UNDEFINED",n.UserCanceled="USER_CANCELED",e.QrStatus=void 0,(s=e.QrStatus||(e.QrStatus={}))[s.Pending=0]="Pending",s[s.Success=1]="Success",s[s.Fail=2]="Fail",e.RequestUrl=void 0,(o=e.RequestUrl||(e.RequestUrl={})).getQR="https://login.ont.id/scan/qr-code/challenge",o.getQRResult="https://login.ont.id/scan/qr-code/result",e.RequestUrlTest=void 0,(i=e.RequestUrlTest||(e.RequestUrlTest={})).getQR="http://172.168.3.240:31843/qr-code/challenge",i.getQRResult="http://172.168.3.240:31843/qr-code/result";const l=async(e,t,r)=>fetch(e,{method:"post",body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"},signal:r}).then((e=>e.json())),u=async(e,t,r)=>fetch(`${e}/${t}`,{signal:r}).then((e=>e.json())),a=e=>new Promise((t=>{setTimeout((()=>{t()}),e)}));let c=!1,d=null;const R=async(t,r=1e3,n)=>{if(c)throw c=!1,d=null,new Error(e.ErrorEnum.UserCanceled);try{d=new AbortController;const{result:s,error:o,desc:i}=await u(n||e.RequestUrl.getQRResult,t,d.signal);if(o)throw new Error(i);if(s.state===e.QrStatus.Pending)return await a(r),R(t);if(s.state===e.QrStatus.Success)return JSON.parse(s.clientResponse);throw new Error(s.error)}catch(t){if("AbortError"===t.name)throw c=!1,d=null,new Error(e.ErrorEnum.UserCanceled);throw t}};return e.cancelQueryQRResult=()=>{c=!0,d&&d.abort()},e.createAuthRequest=(t=e.Action.IdAuth)=>({ver:e.Version.Version1,type:e.MessageType.ClientHello,action:t}),e.createSignData=(e,t)=>({type:"ClientResponse",server:{name:e.server.name,url:e.server.url,...e.server.did?{did:e.server.did}:{}},nonce:e.nonce,did:t,created:Math.floor(Date.now()/1e3)}),e.getRequest=u,e.postRequest=l,e.queryQRResult=R,e.requestQR=async(t,r)=>{const{result:n,error:s,desc:o}=await l(r||e.RequestUrl.getQR,t);if(s)throw new Error(o);return{id:n.id,text:n.qrCode}},e.wait=a,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
